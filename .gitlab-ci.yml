image: registry.gitlab.com/fdroid/ci-images-client:latest

before_script:
  - rm -rf fdroidserver
  - mkdir fdroidserver
  - git ls-remote https://gitlab.com/fdroid/fdroidserver.git master
  - curl --silent https://gitlab.com/fdroid/fdroidserver/repository/master/archive.tar.gz
      | tar -xz --directory=fdroidserver --strip-components=1
  - export PATH="$PWD/fdroidserver:$PATH"
    
lint:
  script:
    # always report on lint errors to the build log
    - sed -i -e 's,textReport .*,textReport true,' app/build.gradle
    - gradlew-fdroid lint
  artifacts:
    paths:
    - app/build/reports/

build:
  script:
    - gradlew-fdroid assembleDebug

fdroid:build:
  script:
    - cd fdroidrepo
    - PYTHONPATH=. fdroid gencibuild eu.bubu1.fdroidclassic
    - cat metadata/eu.bubu1.fdroidclassic.yml
    - fdroid build -v -l eu.bubu1.fdroidclassic
